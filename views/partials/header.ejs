<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<nav class="navbar">
    <div class="navbar-container">
        <div class="logo-container">
            <a href="/" class="logo-link">
                <img src="/images/HLogo3.png" alt="Ciber Crow Logo" class="logo-img" style="z-index: 2;">
            </a>
        </div>
        <div class="nav-links">
            <a href="/">Início</a>
            <a href="/sobre">Sobre</a>
            <a href="/contato">Contato</a>
        </div>
        <div class="nav-links">
            <a href="/" class="nav-service <%= currentPath === '/' ? 'active' : '' %>">
                <i class="fas fa-tachometer-alt"></i> Crow Speed
            </a>
            <a href="/security" class="nav-service <%= currentPath === '/security' ? 'active' : '' %>">
                <i class="fas fa-shield-alt"></i> Crow Security
            </a>
        </div>
        <div class="nav-links" id="auth-buttons">
            <a href="/login" id="login-button" style="<%= typeof isAuthenticated !== 'undefined' && isAuthenticated ? 'display: none;' : '' %>">
                <i class="fas fa-sign-in-alt"></i> Login
            </a>
            <div id="user-menu" style="position: relative; display: <%= typeof isAuthenticated !== 'undefined' && isAuthenticated ? 'inline-block' : 'none' %>;">
                <button id="userDropdown" style="background: none; border: none; color: #fff; cursor: pointer; padding: 5px 10px;">
                    <i class="fas fa-user-circle" style="font-size: 24px;"></i>
                    <span id="username-display" style="margin-left: 5px;">Conta</span>
                    <i class="fas fa-caret-down" style="margin-left: 5px;"></i>
                </button>
                <div id="dropdownContent" style="display: none; position: absolute; right: 0; background: #2c3e50; min-width: 200px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 1000; border-radius: 4px; padding: 10px 0;">
                    <div style="padding: 10px 15px; border-bottom: 1px solid #34495e;">
                        <div id="dropdown-username" style="font-weight: bold;">Usuário</div>
                        <small id="dropdown-email" style="color: #95a5a6;">user@example.com</small>
                    </div>
                    <a href="/perfil" style="display: block; padding: 8px 15px; color: #ecf0f1; text-decoration: none;">
                        <i class="fas fa-user" style="width: 20px; margin-right: 10px;"></i>Meu Perfil
                    </a>
                    <a href="/configuracoes" style="display: block; padding: 8px 15px; color: #ecf0f1; text-decoration: none;">
                        <i class="fas fa-cog" style="width: 20px; margin-right: 10px;"></i>Configurações
                    </a>
                    <a href="#" id="logout-button" style="display: block; padding: 8px 15px; color: #e74c3c; text-decoration: none;">
                        <i class="fas fa-sign-out-alt" style="width: 20px; margin-right: 10px;"></i>Sair
                    </a>
                </div>
            </div>
        </div>
        
        
        
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const loginButton = document.getElementById('login-button');
                const userMenu = document.getElementById('user-menu');
                const dropdownButton = document.getElementById('userDropdown');
                const dropdownContent = document.getElementById('dropdownContent');
                const logoutButton = document.getElementById('logout-button');
                const usernameDisplay = document.getElementById('username-display');
                
                // Toggle do dropdown
                if (dropdownButton && dropdownContent) {
                    dropdownButton.addEventListener('click', function(e) {
                        e.stopPropagation();
                        dropdownContent.style.display = dropdownContent.style.display === 'block' ? 'none' : 'block';
                    });
                }

                // Fechar dropdown ao clicar fora
                document.addEventListener('click', function() {
                    if (dropdownContent) {
                        dropdownContent.style.display = 'none';
                    }
                });

                // Verificar se o usuário está autenticado
                const user = localStorage.getItem('user');
                if (user) {
                    const userData = JSON.parse(user);
                    if (loginButton) loginButton.style.display = 'none';
                    if (userMenu) userMenu.style.display = 'inline-block';
                    
                    // Atualizar informações do usuário
                    if (usernameDisplay) usernameDisplay.textContent = userData.username || 'Conta';
                    
                    const dropdownUsername = document.getElementById('dropdown-username');
                    const dropdownEmail = document.getElementById('dropdown-email');
                    
                    if (dropdownUsername) dropdownUsername.textContent = userData.username || 'Usuário';
                    if (dropdownEmail) dropdownEmail.textContent = userData.email || '';
                }
                
                // Logout
                if (logoutButton) {
                    logoutButton.addEventListener('click', async function(e) {
                        e.preventDefault();
                        try {
                            const response = await fetch('/api/auth/logout', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': `Bearer ${localStorage.getItem('accessToken')}`
                                },
                                credentials: 'include'
                            });
                            
                            if (response.ok) {
                                // Limpar dados de autenticação
                                localStorage.removeItem('accessToken');
                                localStorage.removeItem('refreshToken');
                                localStorage.removeItem('user');
                                
                                // Redirecionar para a página inicial
                                window.location.href = '/';
                            } else {
                                throw new Error('Falha ao fazer logout');
                            }
                        } catch (error) {
                            console.error('Erro ao fazer logout:', error);
                            alert('Ocorreu um erro ao fazer logout. Por favor, tente novamente.');
                        }
                    });
                }
            });
        </script>
                </div>
            </div>
        </div>
    </div>
</nav>
