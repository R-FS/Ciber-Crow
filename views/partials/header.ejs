<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<nav class="navbar">
    <div class="navbar-container">
        <div class="logo-container">
            <a href="/" class="logo-link">
                <img src="/images/HLogo3.png" alt="Ciber Crow Logo" class="logo-img" style="z-index: 2;">
            </a>
        </div>
        <div class="nav-links">
            <a href="/">Início</a>
            <a href="/sobre">Sobre</a>
            <a href="/contato">Contato</a>
        </div>
        <div class="nav-links">
            <a href="/" class="nav-service <%= currentPath === '/' ? 'active' : '' %>">
                <i class="fas fa-tachometer-alt"></i> Crow Speed
            </a>
            <div class="dropdown">
                <% const isSecuritySection = currentPath === '/security' || currentPath === '/network-monitoring' %>
                <a href="#" class="nav-service dropdown-toggle <%= isSecuritySection ? 'active' : '' %>">
                    <i class="fas fa-shield-alt"></i> Crow Security <i class="fas fa-caret-down"></i>
                </a>
                <div class="dropdown-menu">
                    <a href="/security" class="<%= currentPath === '/security' ? 'active' : '' %>">
                        <i class="fas fa-shield-alt"></i> Security Dashboard
                    </a>
                    <a href="/network-monitoring" class="<%= currentPath === '/network-monitoring' ? 'active' : '' %>">
                        <i class="fas fa-network-wired"></i> Network Monitoring
                    </a>
                </div>
            </div>
        </div>
        <div class="nav-links" id="auth-buttons">
            <a href="/login" id="login-button" class="<%= typeof isAuthenticated !== 'undefined' && isAuthenticated ? 'hidden' : '' %>">
                <i class="fas fa-sign-in-alt"></i> Login
            </a>
            <div id="user-menu" class="<%= typeof isAuthenticated !== 'undefined' && isAuthenticated ? 'visible' : '' %>">
                <button id="userDropdown" class="user-dropdown-button">
                    <i class="fas fa-user-circle user-dropdown-icon"></i>
                    <span id="username-display" class="user-dropdown-text">Conta</span>
                    <i class="fas fa-caret-down user-dropdown-caret"></i>
                </button>
                <div id="dropdownContent" class="user-dropdown">
                    <div class="user-dropdown-header">
                        <div id="dropdown-username" class="user-dropdown-username">Usuário</div>
                        <small id="dropdown-email" class="user-dropdown-email">user@example.com</small>
                    </div>
                    <a href="/perfil" class="user-dropdown-link">
                        <i class="fas fa-user"></i>Meu Perfil
                    </a>
                    <a href="/configuracoes" class="user-dropdown-link">
                        <i class="fas fa-cog"></i>Configurações
                    </a>
                    <a href="#" id="logout-button" class="user-dropdown-link logout">
                        <i class="fas fa-sign-out-alt"></i>Sair
                    </a>
                </div>
            </div>
        </div>
        
        
        
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const loginButton = document.getElementById('login-button');
                const userMenu = document.getElementById('user-menu');
                const dropdownButton = document.getElementById('userDropdown');
                const dropdownContent = document.getElementById('dropdownContent');
                const logoutButton = document.getElementById('logout-button');
                const usernameDisplay = document.getElementById('username-display');
                
                // Toggle do dropdown
                if (dropdownButton && dropdownContent) {
                    dropdownButton.addEventListener('click', function(e) {
                        e.stopPropagation();
                        dropdownContent.classList.toggle('visible');
                    });
                }

                // Fechar dropdown ao clicar fora
                document.addEventListener('click', function() {
                    if (dropdownContent && dropdownContent.classList.contains('visible')) {
                        dropdownContent.classList.remove('visible');
                    }
                });

                // Verificar se o usuário está autenticado
                const user = localStorage.getItem('user');
                if (user) {
                    const userData = JSON.parse(user);
                    
                    // Atualizar informações do usuário
                    if (usernameDisplay) {
                        usernameDisplay.textContent = userData.username || 'Conta';
                    }
                    
                    const dropdownUsername = document.getElementById('dropdown-username');
                    const dropdownEmail = document.getElementById('dropdown-email');
                    
                    if (dropdownUsername) dropdownUsername.textContent = userData.username || 'Usuário';
                    if (dropdownEmail) dropdownEmail.textContent = userData.email || '';
                }
                
                // Logout
                if (logoutButton) {
                    logoutButton.addEventListener('click', async function(e) {
                        e.preventDefault();
                        try {
                            const response = await fetch('/api/auth/logout', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': `Bearer ${localStorage.getItem('accessToken')}`
                                },
                                credentials: 'include'
                            });
                            
                            if (response.ok) {
                                // Limpar dados de autenticação
                                localStorage.removeItem('accessToken');
                                localStorage.removeItem('refreshToken');
                                localStorage.removeItem('user');
                                
                                // Redirecionar para a página inicial
                                window.location.href = '/';
                            } else {
                                throw new Error('Falha ao fazer logout');
                            }
                        } catch (error) {
                            console.error('Erro ao fazer logout:', error);
                            alert('Ocorreu um erro ao fazer logout. Por favor, tente novamente.');
                        }
                    });
                }
            });
        </script>
    </div>
</nav>
