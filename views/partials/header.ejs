<nav class="navbar">
    <div class="navbar-container">
        <div class="logo-container">
            <a href="/" class="logo-link">
                <img src="/images/HLogo3.png" alt="Ciber Crow Logo" class="logo-img" style="z-index: 2;">
            </a>
        </div>
        <div class="nav-links">
            <a href="/">Início</a>
            <a href="/sobre">Sobre</a>
            <a href="/contato">Contato</a>
        </div>
        <div class="nav-links">
            <a href="/" class="nav-service <%= currentPath === '/' ? 'active' : '' %>">
                <i class="fas fa-tachometer-alt"></i> Crow Speed
            </a>
            <a href="/security" class="nav-service <%= currentPath === '/security' ? 'active' : '' %>">
                <i class="fas fa-shield-alt"></i> Crow Security
            </a>
        </div>
        <div class="nav-links" id="auth-buttons">
            <a href="/login" id="login-button" class="<%= typeof isAuthenticated !== 'undefined' && isAuthenticated ? 'd-none' : '' %>">
                <i class="fas fa-sign-in-alt"></i> Login
            </a>
            <div id="user-menu" class="<%= typeof isAuthenticated === 'undefined' || !isAuthenticated ? 'd-none' : '' %>">
                <div class="dropdown">
                    <button class="btn btn-link nav-link dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-user-circle"></i> <span id="username-display">Conta</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                        <li><a class="dropdown-item" href="/perfil"><i class="fas fa-user"></i> Perfil</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" id="logout-button"><i class="fas fa-sign-out-alt"></i> Sair</a></li>
                    </ul>
                </div>
            </div>
        </div>
        
        <style>
            .d-none { display: none !important; }
            .dropdown-menu { min-width: 200px; }
            .dropdown-item { padding: 0.5rem 1.5rem; }
            .dropdown-item i { width: 20px; margin-right: 10px; }
            #user-menu { display: inline-block; }
            #userDropdown { color: #fff; text-decoration: none; padding: 0.5rem 0.5rem; }
            #userDropdown:hover { color: #ccc; }
        </style>
        
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const loginButton = document.getElementById('login-button');
                const userMenu = document.getElementById('user-menu');
                const logoutButton = document.getElementById('logout-button');
                const usernameDisplay = document.getElementById('username-display');
                
                // Verificar se o usuário está autenticado
                const user = localStorage.getItem('user');
                if (user) {
                    const userData = JSON.parse(user);
                    if (loginButton) loginButton.classList.add('d-none');
                    if (userMenu) userMenu.classList.remove('d-none');
                    if (usernameDisplay) usernameDisplay.textContent = userData.username || 'Conta';
                }
                
                // Logout
                if (logoutButton) {
                    logoutButton.addEventListener('click', async function(e) {
                        e.preventDefault();
                        try {
                            const response = await fetch('/api/auth/logout', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': `Bearer ${localStorage.getItem('accessToken')}`
                                },
                                credentials: 'include'
                            });
                            
                            if (response.ok) {
                                // Limpar dados de autenticação
                                localStorage.removeItem('accessToken');
                                localStorage.removeItem('refreshToken');
                                localStorage.removeItem('user');
                                
                                // Redirecionar para a página inicial
                                window.location.href = '/';
                            } else {
                                throw new Error('Falha ao fazer logout');
                            }
                        } catch (error) {
                            console.error('Erro ao fazer logout:', error);
                            alert('Ocorreu um erro ao fazer logout. Por favor, tente novamente.');
                        }
                    });
                }
            });
        </script>

    </div>
</nav>
